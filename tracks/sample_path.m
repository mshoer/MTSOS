clear all
close all

%% Discretization Parameters
stepsize = 0.05;
maxsval = 0.95;

%% Bezier Control Points, Bernstein Basis
P(1,:,:)=[-40.100000 -8.000000;-36.942673 -12.375033;-28.918868 -12.844245;-22.303527 -8.201422;-14.554217 -7.472839; -10.500000 -10.500000];

P(2,:,:)=[-10.500000 -10.500000;-6.445783 -13.527161;-6.086659 -20.310065;-9.476511 -25.003793;-8.461375 -29.765064; -6.000000 -30.600000];

P(3,:,:)=[-6.000000 -30.600000;-3.538625 -31.434936;0.368988 -28.343537;1.161530 -21.805210;4.561413 -14.445027; 10.200000 -10.500000];

P(4,:,:)=[10.200000 -10.500000;15.838587 -6.554973;23.715878 -6.025100;30.474232 -6.806609;38.108428 -3.430467; 40.100000 4.000000];

P(5,:,:)=[40.100000 4.000000;42.091572 11.430467;38.440521 22.915260;26.904127 32.409751;15.880548 33.446311; 10.200000 30.300000];

P(6,:,:)=[10.200000 30.300000;4.519452 27.153689;4.181936 19.824505;7.602172 15.156702;10.057360 9.077036; 9.000000 4.000000];

P(7,:,:)=[9.000000 4.000000;7.942640 -1.077036;3.372731 -5.151441;-2.803316 -6.042000;-7.679238 -4.430675; -10.400000 -2.000000];

P(8,:,:)=[-10.400000 -2.000000;-13.120762 0.430675;-13.686362 3.680700;-13.986013 6.080552;-15.543332 9.567622; -20.300000 10.700000];

P(9,:,:)=[-20.300000 10.700000;-25.056668 11.832378;-33.012684 10.610062;-41.548175 4.655889;-43.257327 -3.624967; -40.100000 -8.000000];

%% Compute Path
x = [];
y = [];
for i=1:length(P)
    syms t
    B = bernsteinMatrix(5,t);
    bezierCurve = simplify(B*reshape(P(i,:,:),6,2));
    fplot(bezierCurve(1), bezierCurve(2), [0, 1.0])
    hold on
    scatter(P(i,:,1), P(i,:,2),'filled', 'blue')
    plot(P(i,:,1),P(i,:,2), '--', 'color', 'black');

    x = [x double(subs(bezierCurve(1),0:stepsize:maxsval))];
    y = [y double(subs(bezierCurve(2),0:stepsize:maxsval))];
end

title('Closed Planar Curve Constructed by Quintic Pythagorean Hodographs, With Minimum Time Trajectory')

csvwrite('quintic_hodograph.txt', [x; y])